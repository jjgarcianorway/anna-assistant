# Anna 1.0 - Critical Issues from User Testing

**Date:** 2025-11-07
**Tester Feedback:** Real-world usage with RC.8.3
**Status:** BLOCKING 1.0 RELEASE

---

## ğŸš¨ CRITICAL BUGS (Must Fix Immediately)

### 1. Daemon Crash Detection Failure
**Severity:** CRITICAL
**Status:** ğŸ”´ BROKEN

**Problem:**
- Daemon crashed but `annactl doctor` reports "âœ“ Anna daemon running"
- Uses `systemctl is-active` which can return success even when process crashed
- No crash detection or notification system
- No automatic restart notification to user

**Impact:**
- Users don't know when daemon fails
- Commands hang waiting for unresponsive daemon
- False sense of security

**Fix Required:**
1. Doctor must check both:
   - `systemctl is-active annad` (service state)
   - Actual socket connection test
   - Process existence check
2. Add crash detection and user notification
3. Log crash reasons for debugging
4. Notify user when daemon restarts unexpectedly

---

### 2. Status Command Slowness
**Severity:** HIGH
**Status:** ğŸ”´ BROKEN

**Problem:**
- Takes ~10 seconds to realize daemon is started and running
- Unacceptable UX for a status check

**Fix Required:**
- Optimize RPC connection timeout
- Add fast-fail for unresponsive daemon
- Cache daemon status with short TTL
- Show immediate "checking..." feedback

---

### 3. Category Chaos - 142 Recommendations!
**Severity:** HIGH
**Status:** ğŸ”´ BROKEN

**Problem:**
```
â€¢ 17 suggestions about Utilities
â€¢ 10 suggestions about Security & Privacy
â€¢ 7 suggestions about Security & Privacy        â† DUPLICATE!
â€¢ 9 suggestions about Development Tools
â€¢ 5 suggestions about Development Tools         â† DUPLICATE!
â€¢ 7 suggestions about System Configuration
â€¢ 4 suggestions about System Configuration      â† DUPLICATE!
â€¢ 5 suggestions about configuration             â† lowercase!
â€¢ 3 suggestions about applications              â† lowercase!
â€¢ 2 suggestions about usability                 â† lowercase!
â€¢ 2 suggestions about monitoring                â† lowercase!
â€¢ 2 suggestions about terminal                  â† lowercase!
â€¢ 1 suggestions about network                   â† lowercase!
â€¢ 1 suggestions about documentation             â† lowercase!
```

**Issues:**
1. Duplicate categories (Security & Privacy x2, Development Tools x2)
2. Inconsistent capitalization (Security & Privacy vs configuration)
3. Vague categories (utilities, applications)
4. 142 total recommendations is overwhelming

**Fix Required:**
1. Normalize ALL category names to Title Case
2. Merge duplicate categories
3. Reduce to max 30-40 recommendations by:
   - Better telemetry-based filtering
   - Priority weighting based on user behavior
   - Remove low-value suggestions

---

## ğŸ¯ HIGH PRIORITY IMPROVEMENTS

### 4. Doctor Command Wrong Focus
**Severity:** MEDIUM
**Status:** ğŸŸ¡ NEEDS REDESIGN

**Current Behavior:**
- Checks general system health (pacman, disk, network, firewall)
- Fails to detect Anna-specific problems

**Required Behavior:**
Doctor should ONLY check Anna health:
- âœ“ Daemon running and responsive
- âœ“ Socket permissions correct
- âœ“ Socket file exists and accessible
- âœ“ Dependencies satisfied (curl, jq, etc.)
- âœ“ Binaries exist and executable
- âœ“ Service file correct and loaded
- âœ“ No permission issues
- âœ“ Config file valid
- âœ“ Log directory writable

**Fix:** Completely rewrite doctor command to focus on Anna diagnostics only.

---

### 5. Report vs Advise Confusion
**Severity:** MEDIUM
**Status:** ğŸŸ¡ NEEDS SEPARATION

**Current:** Both commands show similar information
**Required:**

**`annactl report`** - System Status Report:
- Plain English hardware detection
- Missing firmware/drivers
- Package analysis (what's installed, versions)
- Performance metrics
- Security posture
- Written like a sysadmin report
- Based on telemetry: "You spend X% CPU time on vim"

**`annactl advise`** - Improvement Recommendations:
- Suggestions for improvements
- Based on user telemetry (CLI vs GUI preference)
- Prioritized by actual usage
- Alternative software suggestions
- Package improvement suggestions

**Example Report:**
```
System Report for rocinante
Generated: 2025-11-07 14:30

Hardware:
  CPU: AMD Ryzen 9 5900X (12 cores, 24 threads)
  RAM: 32GB DDR4
  GPU: NVIDIA RTX 3080 (driver: nvidia 545.29.06)
  Display: Wayland (Hyprland compositor)

Analysis:
  - All firmware up to date
  - NVIDIA proprietary driver installed and functioning
  - CPU microcode: AMD 0x0a20120a (current)

Usage Pattern (last 7 days):
  - CLI-focused user (85% terminal time)
  - Top applications: vim (40%), firefox (25%), kitty (20%)
  - Development workflow detected (git, cargo, npm usage)

Package Health:
  - 1,247 packages installed
  - 0 orphaned packages
  - 2.1GB package cache
  - Last update: 2 days ago
```

---

### 6. Telemetry-Based Prioritization
**Severity:** MEDIUM
**Status:** ğŸŸ¡ NEEDS IMPLEMENTATION

**Requirements:**
1. Track user behavior:
   - CLI vs GUI usage ratio
   - Most-used applications (CPU time)
   - Development patterns (languages, tools)
   - Desktop environment usage

2. Prioritize recommendations:
   - If 85% terminal time â†’ prioritize CLI tools
   - If heavy vim usage â†’ prioritize vim improvements
   - If GUI focused â†’ prioritize GUI apps
   - If gaming detected â†’ gaming tools higher priority

3. Reduce noise:
   - Don't suggest VLC if user happily uses MPV
   - Don't suggest GUI tools to CLI-only users
   - Don't suggest laptop tools on desktop

---

### 7. Category Organization
**Severity:** MEDIUM
**Status:** ğŸŸ¡ NEEDS STRUCTURE

**Current:** Flat category list
**Required:** Hierarchical categories

```
Development Tools
  â”œâ”€ Alternative Software
  â”‚  â”œâ”€ helix (instead of vim)
  â”‚  â””â”€ neovim (instead of vim)
  â””â”€ Improved Packages
     â”œâ”€ eza (instead of ls)
     â”œâ”€ bat (instead of cat)
     â””â”€ ripgrep (instead of grep)

Multimedia
  â”œâ”€ Alternative Software
  â”‚  â”œâ”€ vlc (instead of mpv)
  â”‚  â””â”€ celluloid (instead of mpv)
  â””â”€ New Capabilities
     â”œâ”€ spotify
     â””â”€ obs-studio
```

---

## ğŸ¨ MEDIUM PRIORITY IMPROVEMENTS

### 8. Completions Auto-Install
**Severity:** LOW
**Status:** ğŸŸ¡ NEEDS CHANGE

**Current:** Completions are a user option
**Required:** Auto-install during install/update if not present

- Check for bash/zsh/fish completion dirs
- Silently install if missing
- No user prompting needed
- Part of install/update process

---

### 9. Bundle Startup Messages (Tiling WMs)
**Severity:** LOW
**Status:** ğŸŸ¡ NEEDS IMPLEMENTATION

**For:** hyprland, i3, sway, niri, etc.

**Required:**
- Show keyboard shortcut guide on first login
- Written by Anna in friendly, welcoming tone
- Checkbox "Don't show again"
- Persisted in user config

**Example:**
```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  Welcome to Hyprland! - Anna Assistant          â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

Hey there! I've set up Hyprland for you with some sensible
keyboard shortcuts to get you started:

Essential Shortcuts:
  SUPER + Enter       â†’ Open terminal (kitty)
  SUPER + D           â†’ Application launcher (wofi)
  SUPER + Q           â†’ Close window
  SUPER + [1-9]       â†’ Switch workspace
  SUPER + Shift + [1-9] â†’ Move window to workspace
  SUPER + Mouse drag  â†’ Move window
  SUPER + F           â†’ Toggle fullscreen

Configuration:
  ~/.config/hypr/hyprland.conf

Need help? Run: annactl advise hyprland

[ ] Don't show this again

[Press Enter to continue]
```

---

### 10. Bundle Completeness
**Severity:** MEDIUM
**Status:** ğŸŸ¡ NEEDS WORK

**Required:** All DE/WM bundles must provide:
- Complete, working desktop environment
- All essential functionality (wifi, bluetooth, audio, notifications)
- Beautiful, functional defaults
- Everything configured and working out of the box

**Bundles to perfect:**
- âœ“ Hyprland (reference implementation)
- â³ GNOME
- â³ KDE Plasma
- â³ i3
- â³ Sway
- â³ Cinnamon
- â³ XFCE
- â³ MATE
- â³ Niri

---

## ğŸ“Š IMPLEMENTATION PLAN

### Phase 1: Critical Fixes (RC.9)
- [ ] Fix daemon crash detection in doctor
- [ ] Fix status slowness
- [ ] Fix category duplicates and capitalization
- [ ] Reduce recommendations to <50

### Phase 2: Command Separation (RC.10)
- [ ] Rewrite doctor to focus on Anna only
- [ ] Separate report vs advise
- [ ] Implement telemetry-based prioritization

### Phase 3: Polish (RC.11)
- [ ] Auto-install completions
- [ ] Hierarchical categories
- [ ] Bundle startup messages
- [ ] Complete all DE/WM bundles

### Phase 4: 1.0 Release
- [ ] All critical bugs fixed
- [ ] All commands working perfectly
- [ ] Documentation complete
- [ ] Fresh install tested
- [ ] Update path tested

---

## ğŸ“ USER QUOTES

> "still annactl status takes around 10s to realized that is started and running"

> "annactl status reports 142 recommendations... you cannot give as many recommendations to a user"

> "IMPORTANT: for whatever reason annad is not running now... maybe has crashed or something... be aware of that!!!"

> "The doctor option is pretty useless... is not even detecting that the service is not running"

> "Doctor option must be focused on fixing anna problems, nothing else"

> "improve the telemetry as much as possible so you give the proper recommendations... step by step"

> "if the user seems to spend tons of CPU time using vim, improvements on vim take priority"

---

## ğŸ¯ SUCCESS CRITERIA FOR 1.0

**Must Have:**
- âœ“ Daemon stable and auto-recovers
- âœ“ All commands respond in <1 second
- âœ“ Doctor accurately detects Anna problems
- âœ“ <50 recommendations max
- âœ“ Telemetry-based prioritization working
- âœ“ Clear separation: report vs advise
- âœ“ No duplicate categories
- âœ“ Consistent capitalization everywhere

**Nice to Have:**
- Complete bundles for all DEs/WMs
- Startup messages for tiling WMs
- Hierarchical categories
- Weekly usage reports
